apiVersion: "argoproj.io/v1alpha1"
kind: "Application"
metadata:
  name: "kisobran-${{values.app}}-staging"
  namespace: "argo-cd"
  finalizers:
  - "resources-finalizer.argocd.argoproj.io"
spec:
  destination:
    namespace: "argo-cd"
    server: "https://kubernetes.default.svc"
  project: "${{values.app}}-staging"
  source:
    path: "./argocd/staging"
    repoURL: "https://github.com/${{values.git-owner}}/${{values.app}}-infrastructure.git"
    targetRevision: "main"
    helm:
      valueFiles:
      - values.yaml
  syncPolicy:
    automated:
      prune: false
      selfHeal: true
    syncOptions:
    - "CreateNamespace=true"
